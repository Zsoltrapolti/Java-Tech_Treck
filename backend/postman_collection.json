{
  "info": {
    "_postman_id": "d9b3c6da-5bd4-4d01-9f10-collection",
    "name": "Krumpi Backend API",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "description": "Collection for testing APIs in Spring Boot on port 8081 (Basic Auth admin/password). Create payloads use Postman dynamic variables for random data."
  },
  "variable": [
    { "key": "base_url", "value": "http://localhost:8081" },
    { "key": "basic_auth_user", "value": "admin" },
    { "key": "basic_auth_password", "value": "password" },
    { "key": "productId", "value": "1" },
    { "key": "employeeId", "value": "1" },
    { "key": "orderId", "value": "1" }
  ],
  "item": [
    {
      "name": "Auth",
      "item": [
        {
          "name": "Register (no auth required, random user)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"user{{$randomInt}}\",\n  \"password\": \"pass{{$randomInt}}\",\n  \"role\": \"USER\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/auth/register",
              "host": ["{{base_url}}"],
              "path": ["api", "auth", "register"]
            },
            "auth": { "type": "noauth" }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200 || pm.response.code === 201 || pm.response.code === 409) {",
                  "  const req = JSON.parse(pm.request.body.raw);",
                  "  pm.collectionVariables.set('basic_auth_user', req.username);",
                  "  pm.collectionVariables.set('basic_auth_password', req.password);",
                  "  pm.test('Register response ok', function() {",
                  "    pm.expect([200,201,409]).to.include(pm.response.code);",
                  "  });",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "Register Employee (random)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"employee{{$randomInt}}\",\n  \"password\": \"pass{{$randomInt}}\",\n  \"role\": \"EMPLOYEE\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/auth/register",
              "host": ["{{base_url}}"],
              "path": ["api", "auth", "register"]
            },
            "auth": { "type": "noauth" }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200 || pm.response.code === 201 || pm.response.code === 409) {",
                  "  const req = JSON.parse(pm.request.body.raw);",
                  "  pm.collectionVariables.set('basic_auth_user', req.username);",
                  "  pm.collectionVariables.set('basic_auth_password', req.password);",
                  "  pm.test('Register employee response ok', function() {",
                  "    pm.expect([200,201,409]).to.include(pm.response.code);",
                  "  });",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "Register Admin (random)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"admin{{$randomInt}}\",\n  \"password\": \"pass{{$randomInt}}\",\n  \"role\": \"ADMIN\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/auth/register",
              "host": ["{{base_url}}"],
              "path": ["api", "auth", "register"]
            },
            "auth": { "type": "noauth" }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200 || pm.response.code === 201 || pm.response.code === 409) {",
                  "  const req = JSON.parse(pm.request.body.raw);",
                  "  pm.collectionVariables.set('basic_auth_user', req.username);",
                  "  pm.collectionVariables.set('basic_auth_password', req.password);",
                  "  pm.test('Register admin response ok', function() {",
                  "    pm.expect([200,201,409]).to.include(pm.response.code);",
                  "  });",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "Login (no auth required)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"{{basic_auth_user}}\",\n  \"password\": \"{{basic_auth_password}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/auth/login",
              "host": ["{{base_url}}"],
              "path": ["api", "auth", "login"]
            },
            "auth": { "type": "noauth" }
          }
        },
        {
          "name": "Me (requires auth)",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{base_url}}/api/auth/me",
              "host": ["{{base_url}}"],
              "path": ["api", "auth", "me"]
            },
            "auth": {
              "type": "basic",
              "basic": [
                { "key": "username", "value": "{{basic_auth_user}}", "type": "string" },
                { "key": "password", "value": "{{basic_auth_password}}", "type": "string" }
              ]
            }
          }
        }
      ]
    },
    {
      "name": "Products",
      "auth": {
        "type": "basic",
        "basic": [
          { "key": "username", "value": "{{basic_auth_user}}", "type": "string" },
          { "key": "password", "value": "{{basic_auth_password}}", "type": "string" }
        ]
      },
      "item": [
        {
          "name": "List products (roles: USER/EMPLOYEE/ADMIN)",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{base_url}}/api/products",
              "host": ["{{base_url}}"],
              "path": ["api", "products"]
            }
          }
        },
        {
          "name": "Get product by id (roles: USER/EMPLOYEE/ADMIN)",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{base_url}}/api/products/{{productId}}",
              "host": ["{{base_url}}"],
              "path": ["api", "products", "{{productId}}"]
            }
          }
        },
        {
          "name": "Create product (roles: EMPLOYEE/ADMIN)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Product {{$randomInt}}\",\n  \"type\": \"RAW_MATERIAL\",\n  \"unitOfMeasure\": \"kg\",\n  \"quantity\": {{$randomInt}}\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/products",
              "host": ["{{base_url}}"],
              "path": ["api", "products"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201 || pm.response.code === 200) {",
                  "  const json = pm.response.json();",
                  "  if (json.id) pm.collectionVariables.set('productId', json.id);",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "Update product (roles: EMPLOYEE/ADMIN)",
          "request": {
            "method": "PUT",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Product {{$randomInt}}\",\n  \"type\": \"RAW_MATERIAL\",\n  \"unitOfMeasure\": \"kg\",\n  \"quantity\": {{$randomInt}}\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/products/{{productId}}",
              "host": ["{{base_url}}"],
              "path": ["api", "products", "{{productId}}"]
            }
          }
        },
        {
          "name": "Delete product (roles: EMPLOYEE/ADMIN)",
          "request": {
            "method": "DELETE",
            "url": {
              "raw": "{{base_url}}/api/products/{{productId}}",
              "host": ["{{base_url}}"],
              "path": ["api", "products", "{{productId}}"]
            }
          }
        },
        {
          "name": "Health test (roles: USER/EMPLOYEE/ADMIN)",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{base_url}}/api/products/test",
              "host": ["{{base_url}}"],
              "path": ["api", "products", "test"]
            }
          }
        }
      ]
    },
    {
      "name": "Employees",
      "auth": {
        "type": "basic",
        "basic": [
          { "key": "username", "value": "{{basic_auth_user}}", "type": "string" },
          { "key": "password", "value": "{{basic_auth_password}}", "type": "string" }
        ]
      },
      "item": [
        {
          "name": "List employees",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{base_url}}/api/employees",
              "host": ["{{base_url}}"],
              "path": ["api", "employees"]
            }
          }
        },
        {
          "name": "Get employee by id",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{base_url}}/api/employees/{{employeeId}}",
              "host": ["{{base_url}}"],
              "path": ["api", "employees", "{{employeeId}}"]
            }
          }
        },
        {
          "name": "Create employee",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"firstName\": \"{{$randomFirstName}}\",\n  \"lastName\": \"{{$randomLastName}}\",\n  \"role\": \"{{$randomJobTitle}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/employees",
              "host": ["{{base_url}}"],
              "path": ["api", "employees"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201 || pm.response.code === 200) {",
                  "  const json = pm.response.json();",
                  "  if (json.id) pm.collectionVariables.set('employeeId', json.id);",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "Update employee",
          "request": {
            "method": "PUT",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"firstName\": \"{{$randomFirstName}}\",\n  \"lastName\": \"{{$randomLastName}}\",\n  \"role\": \"{{$randomJobTitle}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/employees/{{employeeId}}",
              "host": ["{{base_url}}"],
              "path": ["api", "employees", "{{employeeId}}"]
            }
          }
        },
        {
          "name": "Delete employee",
          "request": {
            "method": "DELETE",
            "url": {
              "raw": "{{base_url}}/api/employees/{{employeeId}}",
              "host": ["{{base_url}}"],
              "path": ["api", "employees", "{{employeeId}}"]
            }
          }
        }
      ]
    },
    {
      "name": "Orders",
      "auth": {
        "type": "basic",
        "basic": [
          { "key": "username", "value": "{{basic_auth_user}}", "type": "string" },
          { "key": "password", "value": "{{basic_auth_password}}", "type": "string" }
        ]
      },
      "item": [
        {
          "name": "List orders",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{base_url}}/api/orders",
              "host": ["{{base_url}}"],
              "path": ["api", "orders"]
            }
          }
        },
        {
          "name": "Get order by id",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{base_url}}/api/orders/{{orderId}}",
              "host": ["{{base_url}}"],
              "path": ["api", "orders", "{{orderId}}"]
            }
          }
        },
        {
          "name": "Create order",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"customerName\": \"{{$randomCompanyName}}\",\n  \"responsibleEmployeeId\": {{employeeId}},\n  \"items\": [\n    {\n      \"productId\": {{productId}},\n      \"quantity\": 10,\n      \"unitPrice\": 12.5\n    }\n  ]\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/orders",
              "host": ["{{base_url}}"],
              "path": ["api", "orders"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201 || pm.response.code === 200) {",
                  "  const json = pm.response.json();",
                  "  if (json.id) pm.collectionVariables.set('orderId', json.id);",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "Update order",
          "request": {
            "method": "PUT",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"customerName\": \"{{$randomCompanyName}}\",\n  \"status\": \"CONFIRMED\",\n  \"responsibleEmployeeId\": {{employeeId}} \n}"
            },
            "url": {
              "raw": "{{base_url}}/api/orders/{{orderId}}",
              "host": ["{{base_url}}"],
              "path": ["api", "orders", "{{orderId}}"]
            }
          }
        },
        {
          "name": "Delete order",
          "request": {
            "method": "DELETE",
            "url": {
              "raw": "{{base_url}}/api/orders/{{orderId}}",
              "host": ["{{base_url}}"],
              "path": ["api", "orders", "{{orderId}}"]
            }
          }
        },
        {
          "name": "Mark order as delivered",
          "request": {
            "method": "POST",
            "url": {
              "raw": "{{base_url}}/api/orders/{{orderId}}/deliver",
              "host": ["{{base_url}}"],
              "path": ["api", "orders", "{{orderId}}", "deliver"]
            }
          }
        },
        {
          "name": "Mark order as confirmed",
          "request": {
            "method": "POST",
            "url": {
              "raw": "{{base_url}}/api/orders/{{orderId}}/confirm",
              "host": ["{{base_url}}"],
              "path": ["api", "orders", "{{orderId}}", "confirm"]
            }
          }
        },
        {
          "name": "Mark order as cancelled",
          "request": {
            "method": "POST",
            "url": {
              "raw": "{{base_url}}/api/orders/{{orderId}}/cancel",
              "host": ["{{base_url}}"],
              "path": ["api", "orders", "{{orderId}}", "cancel"]
            }
          }
        }
      ]
    },
    {
      "name": "Validation Tests",
      "auth": {
        "type": "basic",
        "basic": [
          { "key": "username", "value": "{{basic_auth_user}}", "type": "string" },
          { "key": "password", "value": "{{basic_auth_password}}", "type": "string" }
        ]
      },
      "item": [

        {
          "name": "Product validation - empty fields",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"\",\n  \"type\": \"\",\n  \"unitOfMeasure\": \"\",\n  \"quantity\": -5\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/products",
              "host": ["{{base_url}}"],
              "path": ["api", "products"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 400 returned', () => pm.response.to.have.status(400));",
                  "pm.test('Validation error present', () => {",
                  "  pm.expect(pm.response.json()).to.have.property('error');",
                  "});"
                ]
              }
            }
          ]
        },

        {
          "name": "Employee validation - invalid names",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"firstName\": \"\",\n  \"lastName\": \"A\",\n  \"role\": \"\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/employees",
              "host": ["{{base_url}}"],
              "path": ["api", "employees"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 400 returned', () => pm.response.to.have.status(400));",
                  "pm.test('Employee validation error returned', () => {",
                  "  pm.expect(pm.response.json().error).to.be.a('string');",
                  "});"
                ]
              }
            }
          ]
        },

        {
          "name": "Order validation - missing customerName",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"responsibleEmployeeId\": {{employeeId}},\n  \"items\": []\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/orders",
              "host": ["{{base_url}}"],
              "path": ["api", "orders"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Order validation failed (400)', () => pm.response.to.have.status(400));",
                  "pm.test('Order validation message present', () => {",
                  "  pm.expect(pm.response.json()).to.have.property('error');",
                  "});"
                ]
              }
            }
          ]
        },

        {
          "name": "OrderItem validation - negative quantity",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"customerName\": \"Bad Order\",\n  \"responsibleEmployeeId\": {{employeeId}},\n  \"items\": [\n    {\n      \"productId\": {{productId}},\n      \"quantity\": -10,\n      \"unitPrice\": 5\n    }\n  ]\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/orders",
              "host": ["{{base_url}}"],
              "path": ["api", "orders"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Negative quantity rejected', () => pm.response.to.have.status(400));",
                  "pm.test('Quantity validation error returned', () => {",
                  "  pm.expect(pm.response.json().error).to.include('Quantity');",
                  "});"
                ]
              }
            }
          ]
        },

        {
          "name": "Auth register validation - short password",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"ab\",\n  \"password\": \"123\",\n  \"role\": \"USER\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/auth/register",
              "host": ["{{base_url}}"],
              "path": ["api", "auth", "register"]
            },
            "auth": { "type": "noauth" }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Register validation failed', () => pm.response.to.have.status(400));",
                  "pm.test('Validation error message returned', () => {",
                  "  pm.expect(pm.response.json()).to.have.property('error');",
                  "});"
                ]
              }
            }
          ]
        }

      ]
    }
  ]
}
